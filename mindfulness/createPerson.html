<html>
	<head>
		 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		 <title>正念課程 - 新增帳號</title>
		 <script src="js/sha256.js"></script>
		 <script src="js/setting.js"></script>
		 <link href="css/style.css" rel="stylesheet" type="text/css" media="screen" />
	</head>
<body>
	<div class="center">
		<h1 align="center">正念課程 - 新增帳號</h1>
		<form id="form1">
			<table align="center" style="border: solid 2px gray;" >	
				<tr><td>姓名 <font color="red"> *</font></td><td>:&nbsp;<input type="text" id="pName"><br></td></tr>
				<tr><td>Email <font color="red"> *</font></td><td>:&nbsp;<input type="email" id="pEmail"><br></td></tr>
				<tr><td>密碼 <font color="red"> *</font></td><td>:&nbsp;<input type="password" id="pPassword" onkeyup="SHA256PWD.value = sha256(this.value);"></td></tr>
				<tr><td colspan="2" align="right"><input id="btnSubmit" type="button" value="Submit" onclick="getData()"></td></tr>
			</table>
			<input type="hidden" id="SHA256PWD">
		</form>
	</div>
	<script>
		let userID;
		
		function checkUsername(ret){ 
			let name= document.getElementById('pName').value;
			let encPassword= document.getElementById('SHA256PWD').value;
			initialize();
			if (ret.total > 0){
				alert('該帳號已註冊過!');
				document.getElementById("btnSubmit").disabled = false;
			}
			else{
				personJSONobj.identifier[0].value= userID;
				personJSONobj.identifier[1].value= encPassword;
				personJSONobj.name[0].text= name;
				personJSONobj.telecom[0].value= userID;
				personJSONobj = JSON.stringify(personJSONobj);
				HTTPPostData(FHIRserver + "/Person", personJSONobj);
				alert("註冊成功，需等1-2分鐘才可以登入唷！");
				//document.getElementById("btnSubmit").disabled = false;
				window.close();
			}
		}
		function getData(){
			document.getElementById("btnSubmit").disabled = true;
			if(checkRequiredField(3)){
				userID= document.getElementById('pEmail').value;
				let urlStr= FHIRserver + 'Person?identifier=' + userID;
				HTTPGetData(urlStr, "CheckPersonUserID");
			}
		}
	</script>
</body>
</html>