<html>
	<head>
			<script src="js/sha256.js"></script>
			<script src="js/setting.js"></script>
			<link href="css/style.css" rel="stylesheet" type="text/css" media="screen" />
	</head>
<body>
	<div class="center">
		<h1 align="center">FHIR Person Login</h1>
		<form id="form1">
			<table align="center" style="border: solid 2px gray;" >	
				<tr><td>Username </td><td>:&nbsp;<input type="text" id="pusername"><br></td></tr>
				<tr><td>Password </td><td>:&nbsp;<input type="password" id="ppassword" onkeyup="SHA256PWD.value = sha256(this.value);"></td></tr>
				<tr><td colspan="2" align="right"><input type="button" value="Send" onclick="getData()"></td></tr>
			</table>
			<p align="center"><a href="createPerson.html" target="_blank">Create new account</a></p>
			<input type="hidden" id="SHA256PWD">
		</form>
	</div>
	<script>
		let username, ret="";
		
		function checkUsername(res){ 
			let password= document.getElementById('ppassword').value;
			let encPassword= document.getElementById('SHA256PWD').value;
			let jsonOBJ =JSON.parse(res);
	
			if (jsonOBJ.total == 0) alert('Username unexist!');
			else{
				var retPassword= jsonOBJ.entry[0].resource.identifier[1].value;
				var retName= jsonOBJ.entry[0].resource.name[0].text;
				retUserID= jsonOBJ.entry[0].resource.link[0].target.reference;
			}
			
			if(jsonOBJ.total==1 && encPassword!=retPassword)	alert('Wrong password!');		
			else if(jsonOBJ.total==1 && encPassword==retPassword){
				sessionStorage.setItem("username_param", retName);
				sessionStorage.setItem("userid_param", retUserID);
				window.open("index.html", "_blank");
			}
		}
		
		function getData(){
			username= document.getElementById('pusername').value;
			let urlStr= FHIRserver + 'Person?identifier=Username|' + username;
			HTTPGetData(urlStr, "loginVerify");
		}
	</script>
</body>
</html>