<html>
	<head>
		 <script src="js/sha256.js"></script>
		 <script src="js/setting.js"></script>
		 <link href="css/style.css" rel="stylesheet" type="text/css" media="screen" />
	</head>
<body>
	<div class="center">
		<h1 align="center">FHIR Person Create</h1>
		<form id="form1">
			<table align="center" style="border: solid 2px gray;" >	
				<tr><td>Name </td><td>:&nbsp;<input type="text" id="pname"><br></td></tr>
				<tr><td>Username </td><td>:&nbsp;<input type="text" id="pusername"><br></td></tr>
				<tr><td>Password </td><td>:&nbsp;<input type="password" id="ppassword" onkeyup="SHA256PWD.value = sha256(this.value);"></td></tr>
				<tr>
					<td>Organization </td>
					<td>:&nbsp;
						<select id="resource">
							<option value="2137917">TestOrganization1</option>
							<option value="2139336">TestOrganization2</option>
						</select><br>
					</td>
				</tr>
				<tr>
					<td>Role </td>
					<td>:&nbsp;
						<input type="radio" id="Teacher" name="role" value="Teacher">          &nbsp;Teacher          &nbsp;
						<input type="radio" id="Student" name="role" value="Student">          &nbsp;Student<br>
					</td>
				</tr>
				<tr><td colspan="2" align="right"><input type="button" value="Send" onclick="getData()"></td></tr>
				
			</table>
			<input type="hidden" id="SHA256PWD">
		</form>
	</div>
	<script>
		let username;
		function checkUsername(total){ 
			let role= "Patient", roleID="2138344";
			let name= document.getElementById('pname').value;
			let encPassword= document.getElementById('SHA256PWD').value;
			if (total > 0) alert('Username exist! Use another username!');
			else{
				let dataStr = '{"resourceType": "Person","identifier": [{ "system": "Username","value": "' + username + '"},{"system": "Password","value": "' + encPassword + 
							 '"}],"name": [{"text": "' + name + '"}],' + '"link":[{"target":{"reference":"' + role + '/' + roleID + '","display": "testPatient1"}}]}';
				HTTPPostData(FHIRserver + "/Person", dataStr);
				alert("新增賬號之後，需等1～2分鐘才可以登入唷！");
			}
		}
		function getData(){
			username= document.getElementById('pusername').value;
			let urlStr= FHIRserver + 'Person?identifier=Username|' + username;
			HTTPGetData(urlStr, "CheckPersonUsername");
		}
	</script>
</body>
</html>