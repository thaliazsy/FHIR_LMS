<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>FHIR Upload & Update</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<script src="HTTPRequest.js"></script>
		<link href="style.css" rel="stylesheet" type="text/css" media="screen" />
		
		<style>
		#fieldPost, #fieldPut {
			position: absolute;
			left: 5px;
			top: 320px;
		}
		
		.submitButton{
			position: absolute;
			left: 5px;
			top: 370px;
		}
		
		.resourseValueArea{
			position: absolute;
			right: 5px;
			top: 250px;
		}
		</style>
	</head>

<body style="height: 780px">
	<header class="site-header">
		<div class="clear"></div>
			<div class="inner-wrap">
				<div class="navbar-brand-wpz">
					<a href="http://demo.wpzoom.com/foodica" title="Food Recipes Theme for WordPress">
						<font size="10">學習平台及內容管理系統</font>
					</a>
				</div><!-- .navbar-brand -->
			</div>
		
		<div id="mysticky-wrap" style="margin-bottom: 40px;">
			<div id="mysticky-nav" style="top: -60px;" class="">
				<nav class="main-navbar" role="navigation" style="">
					<div class="inner-wrap">
						<div id="navbar-main">
							<div class="menu-main-container">
								<ul id="menu-main-1" class="navbar-wpz dropdown sf-menu sf-js-enabled sf-arrows">
									<li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-has-children menu-item-207">
										<a href="Create.html">Create</a>
									</li>
									<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-106"><a href="Read.html">Read</a></li>
									<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-163"><a href="Update.html">Update</a></li>
									<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-163"><a href="Delete.html">Delete</a></li>
								</ul>
							</div>
						</div><!-- #navbar-main -->
					</div><!-- ./inner-wrap -->
				</nav>
			</div>
		</div>
		<div class="clear"></div>
	</header>	
	
	Resource Type: &nbsp;<select id="resource_ddl"></select><br>
	Method : &nbsp;
	<input type="radio" name="method" id="post" onchange="showField(this);" onselect="true" checked> Post 
	<input type="radio" name="method" id="put" onchange="showField(this);"> Put<br>
	
	<div id="fieldPost">Total: <input type="number" id="totalPost"></div>
	<div id="fieldPut" style="visibility: hidden">ID: <input type="text" id="resourceID"></div><br>
	
	<input onclick="postData()" type="button" class="submitButton" value="submit" /><br>
	<div class="resourseValueArea">
		Resource Value:<br>
		<!-- <textarea id="resourseValue" style="height:600px; width:700px"></textarea> -->
		<textarea class="form-control" id="resource-body" style="white-space: nowrap; overflow: auto; height: 500px; width:700px" placeholder="(place resource body here)" rows="1"></textarea>
	</div>
	
	<script>
		var temp="";
		var resources= ['Patient','Appointment','Bundle','Composition','Consent','Person','Organization','DiagnosticReport','DocumentReference','Condition',
						'Observation','Encounter','PlanDefinition','Practitioner','PractitionerRole','Location','Schedule','ServiceRequest','Slot','ImagingStudy','MessageHeader'];		
		resources.sort();
		for(const res of resources){
			temp+= "<option>" + res + "</option>";
		}
		document.getElementById("resource_ddl").innerHTML= temp;
		
		var txt= 'A. Upload FHIR data\n1. Check "Post" radiobutton\n2. Insert total amount of data you want to upload\n3. Insert FHIR data you want to upload in the provided textarea\n4. Click Submit\n\n' + 
					'B. Update FHIR data\n1. Check "Put" radiobutton\n2. Insert ID of FHIR data you want to update\n3. Insert FHIR data you want to update in the provided textarea\n4. Click Submit';
		//alert(txt);
		
		var patientIDList=[ "6930","6320","6962","6465","7004","6455","6778","6713","6500","6234",
						"6450","6385","6605","6460","6940","6723","6758","6773","6990","7018",
						"6289","6718","6166","6788","7008","6203","6445","6743","6985","6161",
						"6952","6555","6229","6530","6510","6969","6340","6945","6960","6249",
						"6980","6076","6505","6239","6224","6783","6435","6151","6520","6873",
						"6738","6405","6798"];
						
		function postData() {
			var resourceID = document.getElementById("resource");
			var selected = resourceID.options[resource.selectedIndex].text;
			totalPost = document.getElementById("totalPost").value;
			
			var dataString=document.getElementById("resourseValue").value;
			var apiURL= FHIRserver + selected; 		
			//alert(apiURL);
			if(document.getElementById("post").checked==true)
				HTTPPostData(apiURL, dataString ); 
			else if(document.getElementById("put").checked==true)
				HTTPPutData(apiURL + "/" + document.getElementById("resourceID").value, dataString, 0, "updateBasedOnID");
		}
		
		function updateValue(obj){
			let patID= obj.subject.reference.split('/')[1];
			var curindex=patientIDList.indexOf(patientID)+1;
			var formattedNumber = ("0" + curindex).slice(-2);
			let certID= 'IDTW.CC.1030' + formattedNumber;
			let str= obj.slice(0, -1)
		}

		function showField(t){
			if(t.id == "post"){
				document.getElementById("fieldPost").style.visibility= "visible";
				document.getElementById("fieldPut").style.visibility= "hidden";
			}
			else if(t.id == "put"){
				document.getElementById("fieldPut").style.visibility= "visible";
				document.getElementById("fieldPost").style.visibility= "hidden";
			}
		}
		</script>	
</body>
</html>
